/*! For license information please see main.min.js.LICENSE.txt */
!function(){"use strict";!function(){function e(e){return e.ok||alert(e.statusText),e}const t={"Content-Type":"application/x-www-form-urlencoded"},n=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]');n&&n.addEventListener("click",(()=>{o(n)}));const o=e=>e.checked;function r(){window.localStorage.removeItem("tpay_blik_addepts")}const a=(e,t)=>{const n=c(e);n.style.display=t&&n?"block":"none"},c=e=>{const t=i(e);return document.querySelector(t+" .tpay-preload")},s=e=>{const t=i(e);return document.querySelector(t+" .tpay-blik-response")},i=e=>"use"===e?".tpay-blik--use":".tpay-blik--new";function l(e,t,n,o,r){let a,c=r;const i=null!=blik_limit_attempt_msg?blik_limit_attempt_msg:"",m=null!=blik_accept_msg?blik_accept_msg:"",y=null!=blik_msg?blik_msg:"",b=document.querySelector("#tpay-blik-submit"),f={action:"createOrderByTransactionId",ajax:!0,cartId:o.cartId,transactionId:t};p(e,f).then((e=>{try{let t,{status:n,payments:r,cartId:l}=e,p=s(o.blikOption);if(t=!0,"pending"===n||"error"===n){if(r.attempts&&(p.innerHTML=m,p.classList.add("tpay-blik-response--open")),r.attempts&&0!==r.attempts.length){let n=r.attempts.length-1,c=r.attempts[n].paymentErrorCode;c&&y&&"63"!==c?(p.innerHTML=y[c],p.classList.add("tpay-blik-response--open"),t=d(a,o),u(e,c)):(p.innerHTML=m,p.classList.add("tpay-blik-response--open"))}c>40&&(p.innerHTML=i,p.classList.add("tpay-blik-response--open"),b.classList.remove("disabled"),t=d(a,o),u(e,-1))}return"success"===n&&(t=d(a,o),u(e)),t}catch(e){console.log(e)}})).then((r=>{r&&(a=setTimeout((()=>{l(e,t,n,o,c+1)}),3e3))}))}function d(e,t){return clearInterval(e),a(t.blikOption,!1),!1}function u(e,t=0){0===t?window.location.href=e.backUrl:r()}function p(n,o){const r={method:"POST",headers:t,body:new URLSearchParams(o)};return fetch(n,r).then(e).then((e=>e.json()))}function m(){const e=document.querySelector(".tpay-blik-input"),t=document.querySelectorAll(".tpay-blik-response");document.querySelector("input[name=savedId]");if(!y(e,e.value))return!1;t.forEach((e=>{e.classList.remove("tpay-blik-response--open")})),e.classList.remove("wrong")}function y(e,t){let n;const r=document.querySelector(".tpay-blik--new .tpay-blik-response"),a=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]'),c=(document.querySelector("#conditions-to-approve .custom-checkbox > span"),document.querySelector("#blik-rr"));c.style.display="none";const s=document.querySelector(".blikId"),i=document.querySelector("#blikUse");return!1===o(a)?(c.style.display="block",e.classList.remove("wrong"),r.classList.remove("tpay-blik-response--open"),n=!1):/^[0-9]{3}[0-9]{3}$/.test(t)||null!==s&&i&&!0===i.checked?(e.classList.remove("wrong"),r.classList.remove("tpay-blik-response--open"),n=!0):(e.classList.add("wrong"),r.classList.add("tpay-blik-response--open"),n=!1),n}function b(){const e=document.querySelector(".transferForm"),t=e.querySelectorAll("input[name=tpay_transfer_id]"),n=document.querySelector("#transfer-error"),o=document.querySelector("#payment-confirmation button"),r=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]');if(a=e.closest(".js-payment-option-form"),"none"!==window.getComputedStyle(a).display){let e=Array.from(t).find((e=>e.checked));setTimeout((()=>{e?(n.style.display="none",o.disabled=!1,o.classList.remove("disabled")):r.checked&&(n.style.display="block",o.disabled=!0,o.classList.add("disabled"))}),50)}var a}!function(){const e=document.querySelector("#blik_code"),t=document.querySelector(".tpay-blik--new .tpay-blik-response");e&&e.addEventListener("click",(function(n){e.classList.remove("wrong"),t.classList.remove("tpay-blik-response--open")}))}();const f={"Content-Type":"application/x-www-form-urlencoded"},k=e=>{const t=null!=surcharge_controller?surcharge_controller:null;t&&v(t,e)},v=(e,t)=>{(function(e,t){const n={method:"POST",headers:f,body:new URLSearchParams(t)};return fetch(e,n).then((e=>e.json())).then((e=>e))})(e,{action:"surcharge",ajax:!0,state:t}).then((e=>{!0===e.status&&(document.querySelector(".js-cart-summary-subtotals-container").outerHTML=e.cart_summary_subtotals_container,document.querySelector(".js-cart-summary-totals").outerHTML=e.cart_summary_totals)}))};!function(){const n=document.querySelector("#tpay-blik-form"),o=document.querySelector("input[name=cart_id]");if(n){const c=n.action,i={blikOption:"new",ajax:!0,cartId:parseInt(o.value)};n.addEventListener("submit",(n=>{n.preventDefault(),n.stopPropagation();const o=document.querySelector("#blik_code"),d=document.querySelector(".tpay-radio-payments__radio--active input[name=blikOption]");let u=JSON.parse(window.localStorage.getItem("tpay_blik_addepts"));u&&4===u.attempt&&r();let m=u&&4!==u.attempt?"createTransactionById":"createTransaction";if(i.action=m,i.blikOption=d.value,null!=u&&null!=u.transaction_id&&(i.transactionId=u.transaction_id),"use"===d.value){if(!y(o,o.value))return!1;i.blikCode=""}else if("new"===d.value){if(!y(o,o.value))return!1;i.blikCode=o.value}i&&(a(i.blikOption,!0),function(n,o){const r={method:"POST",headers:t,body:new URLSearchParams(o)};return fetch(n,r).then(e).then((e=>e.json())).then((e=>e))}(c,i).then((e=>{if("success"===e.transaction.result){let t=u&&4!==u.attempt?u.transaction_id:e.transaction.transactionId;!function(e,t,n,o){return r=this,c=null,i=function*(){var r,c,i,d;let u;const m={action:"createTransactionById",ajax:!0,transactionId:t,blikCode:o.blikCode},y=yield p(e,m),b=y.transaction.status,f=null==(r=y.response)?void 0:r.payments,k=(null==(d=null==(i=null==(c=y.response)?void 0:c.payments)?void 0:i.errors)?void 0:d.length)||0;let v,h=s(o.blikOption);if(v=!0,"failed"===b&&(console.log(k),h.innerHTML="failed",h.classList.add("tpay-blik-response--open"),clearInterval(u),a(o.blikOption,!1),v=!1),"pending"===b&&k>0){let e;!function(e){window.localStorage.setItem("tpay_blik_addepts",JSON.stringify(e))}({transaction_id:t,cart_id:o.cartId,attempt:y.transaction.payments.attempts.length});const n=null!=messages?messages:null;for(const t in f.errors)e="payment_failed"===f.errors[t].errorCode?null==n?void 0:n.blik_error:null==n?void 0:n.payment_error,h.innerHTML=e,h.classList.add("tpay-blik-response--open");clearInterval(u),a(o.blikOption,!1),v=!1}"correct"===b&&(clearInterval(u),a(o.blikOption,!1),window.location.href=y.backUrl,v=!1),v&&l(e,t,n,o,1)},new Promise(((e,t)=>{var n=e=>{try{a(i.next(e))}catch(e){t(e)}},o=e=>{try{a(i.throw(e))}catch(e){t(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,o);a((i=i.apply(r,c)).next())}));var r,c,i}(c,t,e,i)}})))}),!1),function(){const e=document.querySelector('#conditions-to-approve input[type="checkbox"]'),t=document.querySelector(".tpay-blik-input");e.addEventListener("click",(()=>{m()})),t.addEventListener("change",(()=>{m()}))}()}}(),function(){const e=document.querySelector(".tpay-payment-gateways");if(e){e.parentNode.parentNode.nextElementSibling;const t=Array.from(document.querySelectorAll(".tpay-payment-gateways__item"));if(t)for(const e of t)e.addEventListener("click",(()=>{b(),t.forEach((e=>{e.classList.remove("tpay-payment-gateways__item--active")})),e.classList.add("tpay-payment-gateways__item--active")}),!1)}}(),function(){const e=Array.from(document.querySelectorAll("input[name=payment-option]"));Array.from(e).forEach((function(e){e.addEventListener("click",(()=>{var t,n;const o=e.closest(".payment-option");t=o.querySelector(".tpay-regulations");h();const a=o.id.replace(/\D/g,"");const c=(s=a,document.querySelector("#payment-option-"+s+"-additional-information"));var s;let i="";if(c){const e=c.querySelector(".tpay-wrapper");i=null!=(n=null==e?void 0:e.getAttribute("data-payment-type"))?n:null}"blik"===i||"card"===i?(document.querySelector("body").classList.add("tpay-hide-process-btn"),r(),S(a,"hide")):(document.querySelector("body").classList.remove("tpay-hide-process-btn"),S(a,"show"));const l=function(e){return document.querySelector("#pay-with-payment-option-"+e+"-form")}(a).querySelector("input[name=tpay]");k(!!l)}))}))}();const h=()=>{const e=document.querySelectorAll(".payment-options .custom-checkbox span"),t=document.querySelectorAll(".payment-options input");e.forEach((e=>{e.classList.remove("wrong")})),t.forEach((e=>{e.classList.remove("wrong")}))};function S(e,t){if(document.querySelector("#tc-payment-confirmation"))return;const n=document.querySelector("#payment-confirmation");let o;"show"===t?o="block":"hide"===t&&(o="none"),setTimeout((function(){n.style.display=o}),250)}!function(){const e=document.querySelectorAll(".tpay-radio-payments__radio");Array.from(e).forEach((t=>{t.addEventListener("click",(n=>{e.forEach((e=>{e.classList.remove("tpay-radio-payments__radio--active")})),t.classList.add("tpay-radio-payments__radio--active"),t.querySelector("input[type=radio]").checked=!0}))}))}(),function(){const e=document.querySelector('#conditions-to-approve input[type="checkbox"]');e&&e.addEventListener("change",(()=>{b()}))}()}()}();