/*! For license information please see main.min.js.LICENSE.txt */
!function(){"use strict";!function(){function e(e){return e.ok||alert(e.statusText),e}const t={"Content-Type":"application/x-www-form-urlencoded"},n=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]');n&&n.addEventListener("click",(()=>{o(n)}));const o=e=>e.checked;function r(){window.localStorage.removeItem("tpay_blik_addepts")}const a=(e,t)=>{const n=c(e);n.style.display=t&&n?"block":"none"},c=e=>{const t=s(e);return document.querySelector(t+" .tpay-preload")},i=e=>{const t=s(e);return document.querySelector(t+" .tpay-blik-response")},s=e=>"use"===e?".tpay-blik--use":".tpay-blik--new";function l(e,t,n,o,r){let a,c=r;const s=null!=blik_limit_attempt_msg?blik_limit_attempt_msg:"",y=null!=blik_accept_msg?blik_accept_msg:"",m=null!=blik_msg?blik_msg:"",f={action:"assignTransactionId",ajax:!0,cartId:o.cartId,transactionId:t};p(e,f).then((e=>{try{let t,{status:n,payments:r,cartId:l}=e,p=i(o.blikOption);if(t=!0,"pending"===n||"error"===n){if(r.attempts&&(p.innerHTML=y,p.classList.add("tpay-blik-response--open")),r.attempts&&0!==r.attempts.length){let n=r.attempts.length-1,c=r.attempts[n].paymentErrorCode;c&&m&&"63"!==c?(p.innerHTML=m[c],p.classList.add("tpay-blik-response--open"),t=u(a,o),d(e,c)):(p.innerHTML=y,p.classList.add("tpay-blik-response--open"))}c>40&&(p.innerHTML=s,p.classList.add("tpay-blik-response--open"),t=u(a,o),d(e,-1))}return"success"===n&&(t=u(a,o),d(e)),t}catch(e){console.log(e)}})).then((r=>{r&&(a=setTimeout((()=>{l(e,t,n,o,c+1)}),3e3))}))}function u(e,t){return clearInterval(e),a(t.blikOption,!1),!1}function d(e,t=0){0===t?window.location.href=e.backUrl:r()}function p(n,o){const r={method:"POST",headers:t,body:new URLSearchParams(o)};return fetch(n,r).then(e).then((e=>e.json()))}var y=(e,t,n)=>new Promise(((o,r)=>{var a=e=>{try{i(n.next(e))}catch(e){r(e)}},c=e=>{try{i(n.throw(e))}catch(e){r(e)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,c);i((n=n.apply(e,t)).next())}));function m(){const n=document.querySelector("#tpay-blik-form"),o=document.querySelector("input[name=cart_id]"),c=document.querySelector("#payment-confirmation button");if(n){const s=n.action,u={blikOption:"new",ajax:!0,cartId:parseInt(o.value)};n.addEventListener("keydown",(e=>{"Enter"===e.key&&e.preventDefault()})),c.addEventListener("click",(o=>{var c=n.parentElement.parentElement;if("none"===window.getComputedStyle(c).display)return;o.preventDefault(),o.stopPropagation();const d=document.querySelector("#blik_code"),m=document.querySelector(".tpay-radio-payments__radio--active input[name=blikOption]");let f=JSON.parse(window.localStorage.getItem("tpay_blik_addepts"));f&&4===f.attempt&&r();let b="createTransaction";if(f&&4!==f.attempt&&u.cartId==f.cart_id&&(b="createTransactionById"),console.log(b),console.log("cart id:"),console.log(u.cartId),f&&console.log(f.cart_id),u.action=b,u.blikOption=m.value,null!=f&&null!=f.transaction_id&&(u.transactionId=f.transaction_id),"use"===m.value){if(!k(d,d.value))return!1;u.blikCode=""}else if("new"===m.value){if(!k(d,d.value))return!1;u.blikCode=d.value}u&&(a(u.blikOption,!0),function(n,o){const r={method:"POST",headers:t,body:new URLSearchParams(o)};return fetch(n,r).then(e).then((e=>e.json())).then((e=>e))}(s,u).then((e=>{if("success"===e.transaction.result){let t=f&&4!==f.attempt?f.transaction_id:e.transaction.transactionId;!function(e,t,n,o){y(this,null,(function*(){var r,c,s,u;let d;const y={action:"createTransactionById",ajax:!0,transactionId:t,blikCode:o.blikCode},m=yield p(e,y),f=m.transaction.status,k=null==(r=m.response)?void 0:r.payments,b=(null==(u=null==(s=null==(c=m.response)?void 0:c.payments)?void 0:s.errors)?void 0:u.length)||0;let h,v=i(o.blikOption);if(h=!0,"failed"===f&&(console.log(b),v.innerHTML="failed",v.classList.add("tpay-blik-response--open"),clearInterval(d),a(o.blikOption,!1),h=!1),"pending"===f&&b>0){let e;!function(e){window.localStorage.setItem("tpay_blik_addepts",JSON.stringify(e))}({transaction_id:t,cart_id:o.cartId,attempt:m.transaction.payments.attempts.length});const n=null!=messages?messages:null;for(const t in k.errors)e="payment_failed"===k.errors[t].errorCode?null==n?void 0:n.blik_error:null==n?void 0:n.payment_error,v.innerHTML=e,v.classList.add("tpay-blik-response--open");clearInterval(d),a(o.blikOption,!1),h=!1}"correct"===f&&(clearInterval(d),a(o.blikOption,!1),window.location.href=m.backUrl,h=!1),h&&l(e,t,n,o,1)}))}(s,t,e,u)}})))}),!1),function(){const e=document.querySelector('#conditions-to-approve input[type="checkbox"]'),t=document.querySelector(".tpay-blik-input");null==e||e.addEventListener("click",(()=>{f()})),null==t||t.addEventListener("change",(()=>{f()}))}()}}function f(){const e=document.querySelector(".tpay-blik-input"),t=document.querySelectorAll(".tpay-blik-response");document.querySelector("input[name=savedId]");if(!k(e,e.value))return!1;t.forEach((e=>{e.classList.remove("tpay-blik-response--open")})),e.classList.remove("wrong")}function k(e,t){let n;const r=document.querySelector(".tpay-blik--new .tpay-blik-response"),a=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]'),c=(document.querySelector("#conditions-to-approve .custom-checkbox > span"),document.querySelector("#blik-rr"));c.style.display="none";const i=document.querySelector(".blikId"),s=document.querySelector("#blikUse");return!1===o(a)?(c.style.display="block",e.classList.remove("wrong"),r.classList.remove("tpay-blik-response--open"),n=!1):/^[0-9]{3}[0-9]{3}$/.test(t)||null!==i&&s&&!0===s.checked?(e.classList.remove("wrong"),r.classList.remove("tpay-blik-response--open"),n=!0):(e.classList.add("wrong"),r.classList.add("tpay-blik-response--open"),n=!1),n}function b(e){let t=!1;const n=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]'),o=document.querySelector("#payment-confirmation button"),r=Array.from(document.querySelectorAll("[id^=payment-option]")).find((e=>e.checked)).id,a=document.querySelector("#pay-with-"+r+"-form"),c=null==a?void 0:a.querySelectorAll(".tpay-payment-gateways__item input").length;if(c){const e=a.querySelectorAll("input[name=tpay_transfer_id]"),n=a.querySelectorAll("input[name=tpay_channel_id]");t=void 0!==Array.from(e).find((e=>e.checked)),t||(t=void 0!==Array.from(n).find((e=>e.checked)))}c>0&&setTimeout((()=>{!function(e,t,n,o){e&&n.checked?(o.style.display="none",t.disabled=!1,t.classList.remove("disabled")):(o.style.display="block",t.disabled=!0,t.classList.add("disabled"))}(t,o,n,a.querySelector(".transfer-error"))}),50)}!function(){const e=document.querySelector("#blik_code"),t=document.querySelector(".tpay-blik--new .tpay-blik-response");e&&e.addEventListener("click",(function(n){e.classList.remove("wrong"),t.classList.remove("tpay-blik-response--open")}))}();const h={"Content-Type":"application/x-www-form-urlencoded"},v=e=>{const t=null!=surcharge_controller?surcharge_controller:null;t&&_(t,e)},_=(e,t)=>{(function(e,t){const n={method:"POST",headers:h,body:new URLSearchParams(t)};return fetch(e,n).then((e=>e.json())).then((e=>e))})(e,{action:"surcharge",ajax:!0,state:t}).then((e=>{!0===e.status&&(document.querySelector(".js-cart-summary-subtotals-container").outerHTML=e.cart_summary_subtotals_container,document.querySelector(".js-cart-summary-totals").outerHTML=e.cart_summary_totals)}))};function S(e){return new Promise(((t,n)=>{let o=document.querySelector(e);o?t(o):new MutationObserver(((n,o)=>{Array.from(document.querySelectorAll(e)).forEach((e=>{t(e),o.disconnect()}))})).observe(document.documentElement,{childList:!0,subtree:!0})}))}function w(){return null!==document.getElementById("supercheckout_confirm_order")}S("#tpay-blik-form").then((()=>{m()})),S(".tpay-payment-gateways").then((()=>{!function(){const e=document.querySelectorAll(".tpay-payment-gateways");e.length>0&&e.forEach((function(e){e.parentNode.parentNode.nextElementSibling;const t=Array.from(e.querySelectorAll(".tpay-payment-gateways__item"));if(t)for(const e of t)e.addEventListener("click",(()=>{b(),t.forEach((e=>{e.classList.remove("tpay-payment-gateways__item--active")})),e.classList.add("tpay-payment-gateways__item--active")}),!1)}))}(),w&&window.addSupercheckoutOrderValidator((function(){if(!document.querySelector(".tpay-payment-gateways").closest("li").querySelector("input[type=radio]").checked)return!0;const e=document.querySelectorAll(".tpay-payment-gateways input[type=radio]");if(Array.from(e).some((e=>e.checked)))return!0;throw window.scrollTo({top:0,behavior:"smooth"}),new Error("Wybierz metodę płatności")}))})),function(){const e=Array.from(document.querySelectorAll("input[id^=payment-option]"));Array.from(e).forEach((function(e){e.addEventListener("click",(()=>{var t;const n=e.closest(".payment-option");t=n.querySelector(".tpay-regulations");g();const o=n.id.replace(/\D/g,"");document.querySelector("body").classList.remove("tpay-hide-process-btn"),function(e,t){if(document.querySelector("#tc-payment-confirmation"))return;const n=document.querySelector("#payment-confirmation");let o;"show"===t?o="block":"hide"===t&&(o="none");setTimeout((function(){n.style.display=o}),250)}(0,"show");const r=(a=o,document.querySelector("#pay-with-payment-option-"+a+"-form")).querySelector("input[name=tpay]");var a;v(!!r)}))}))}();const g=()=>{const e=document.querySelectorAll(".payment-options .custom-checkbox span"),t=document.querySelectorAll(".payment-options input");e.forEach((e=>{e.classList.remove("wrong")})),t.forEach((e=>{e.classList.remove("wrong")}))};!function(){const e=document.querySelectorAll(".tpay-radio-payments__radio");Array.from(e).forEach((t=>{t.addEventListener("click",(n=>{e.forEach((e=>{e.classList.remove("tpay-radio-payments__radio--active")})),t.classList.add("tpay-radio-payments__radio--active"),t.querySelector("input[type=radio]").checked=!0}))}))}(),function(){const e=document.querySelector('#conditions-to-approve input[type="checkbox"]');e&&e.addEventListener("change",(()=>{var e;b(null==(e=document.querySelector(".tpay-payment-gateways__item--active"))||e.closest(".tpay-payment-gateways"))}));document.querySelectorAll('[name="payment-option"]').forEach((function(e){e.addEventListener("change",(()=>{var e;b(null==(e=document.querySelector(".tpay-payment-gateways__item--active"))||e.closest(".tpay-payment-gateways"))}))}))}()}()}();