/*! For license information please see main.min.js.LICENSE.txt */
!function(){"use strict";!function(){function e(e){return e.ok||alert(e.statusText),e}const t={"Content-Type":"application/x-www-form-urlencoded"},n=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]');n&&n.addEventListener("click",(()=>{o(n)}));const o=e=>e.checked;function a(){window.localStorage.removeItem("tpay_blik_addepts")}const r=(e,t)=>{const n=c(e);n.style.display=t&&n?"block":"none"},c=e=>{const t=i(e);return document.querySelector(t+" .tpay-preload")},s=e=>{const t=i(e);return document.querySelector(t+" .tpay-blik-response")},i=e=>"use"===e?".tpay-blik--use":".tpay-blik--new";function l(e,t,n,o,a){let r,c=a;const i=null!=blik_limit_attempt_msg?blik_limit_attempt_msg:"",y=null!=blik_accept_msg?blik_accept_msg:"",m=null!=blik_msg?blik_msg:"",f=document.querySelector("#tpay-blik-submit"),b={action:"assignTransactionId",ajax:!0,cartId:o.cartId,transactionId:t};p(e,b).then((e=>{try{let t,{status:n,payments:a,cartId:l}=e,p=s(o.blikOption);if(t=!0,"pending"===n||"error"===n){if(a.attempts&&(p.innerHTML=y,p.classList.add("tpay-blik-response--open")),a.attempts&&0!==a.attempts.length){let n=a.attempts.length-1,c=a.attempts[n].paymentErrorCode;c&&m&&"63"!==c?(p.innerHTML=m[c],p.classList.add("tpay-blik-response--open"),t=u(r,o),d(e,c)):(p.innerHTML=y,p.classList.add("tpay-blik-response--open"))}c>40&&(p.innerHTML=i,p.classList.add("tpay-blik-response--open"),f.classList.remove("disabled"),t=u(r,o),d(e,-1))}return"success"===n&&(t=u(r,o),d(e)),t}catch(e){console.log(e)}})).then((a=>{a&&(r=setTimeout((()=>{l(e,t,n,o,c+1)}),3e3))}))}function u(e,t){return clearInterval(e),r(t.blikOption,!1),!1}function d(e,t=0){0===t?window.location.href=e.backUrl:a()}function p(n,o){const a={method:"POST",headers:t,body:new URLSearchParams(o)};return fetch(n,a).then(e).then((e=>e.json()))}function y(){const e=document.querySelector(".tpay-blik-input"),t=document.querySelectorAll(".tpay-blik-response");document.querySelector("input[name=savedId]");if(!m(e,e.value))return!1;t.forEach((e=>{e.classList.remove("tpay-blik-response--open")})),e.classList.remove("wrong")}function m(e,t){let n;const a=document.querySelector(".tpay-blik--new .tpay-blik-response"),r=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]'),c=(document.querySelector("#conditions-to-approve .custom-checkbox > span"),document.querySelector("#blik-rr"));c.style.display="none";const s=document.querySelector(".blikId"),i=document.querySelector("#blikUse");return!1===o(r)?(c.style.display="block",e.classList.remove("wrong"),a.classList.remove("tpay-blik-response--open"),n=!1):/^[0-9]{3}[0-9]{3}$/.test(t)||null!==s&&i&&!0===i.checked?(e.classList.remove("wrong"),a.classList.remove("tpay-blik-response--open"),n=!0):(e.classList.add("wrong"),a.classList.add("tpay-blik-response--open"),n=!1),n}function f(e){let t=!1;const n=document.querySelector('input[name="conditions_to_approve[terms-and-conditions]"]'),o=document.querySelector("#payment-confirmation button"),a=Array.from(document.querySelectorAll("[name=payment-option]")).find((e=>e.checked)).id,r=document.querySelector("#pay-with-"+a+"-form"),c=null==r?void 0:r.querySelectorAll(".tpay-payment-gateways__item input").length;if(c){const e=r.querySelectorAll("input[name=tpay_transfer_id]"),n=r.querySelectorAll("input[name=tpay_channel_id]");t=void 0!==Array.from(e).find((e=>e.checked)),t||(t=void 0!==Array.from(n).find((e=>e.checked)))}c>0&&setTimeout((()=>{!function(e,t,n,o){e&&n.checked?(o.style.display="none",t.disabled=!1,t.classList.remove("disabled")):(o.style.display="block",t.disabled=!0,t.classList.add("disabled"))}(t,o,n,r.querySelector(".transfer-error"))}),50)}!function(){const e=document.querySelector("#blik_code"),t=document.querySelector(".tpay-blik--new .tpay-blik-response");e&&e.addEventListener("click",(function(n){e.classList.remove("wrong"),t.classList.remove("tpay-blik-response--open")}))}();const b={"Content-Type":"application/x-www-form-urlencoded"},k=e=>{const t=null!=surcharge_controller?surcharge_controller:null;t&&v(t,e)},v=(e,t)=>{(function(e,t){const n={method:"POST",headers:b,body:new URLSearchParams(t)};return fetch(e,n).then((e=>e.json())).then((e=>e))})(e,{action:"surcharge",ajax:!0,state:t}).then((e=>{!0===e.status&&(document.querySelector(".js-cart-summary-subtotals-container").outerHTML=e.cart_summary_subtotals_container,document.querySelector(".js-cart-summary-totals").outerHTML=e.cart_summary_totals)}))};!function(){const n=document.querySelector("#tpay-blik-form"),o=document.querySelector("input[name=cart_id]");if(n){const c=n.action,i={blikOption:"new",ajax:!0,cartId:parseInt(o.value)};n.addEventListener("submit",(n=>{n.preventDefault(),n.stopPropagation();const o=document.querySelector("#blik_code"),u=document.querySelector(".tpay-radio-payments__radio--active input[name=blikOption]");let d=JSON.parse(window.localStorage.getItem("tpay_blik_addepts"));d&&4===d.attempt&&a();let y=d&&4!==d.attempt?"createTransactionById":"createTransaction";if(i.action=y,i.blikOption=u.value,null!=d&&null!=d.transaction_id&&(i.transactionId=d.transaction_id),"use"===u.value){if(!m(o,o.value))return!1;i.blikCode=""}else if("new"===u.value){if(!m(o,o.value))return!1;i.blikCode=o.value}i&&(r(i.blikOption,!0),function(n,o){const a={method:"POST",headers:t,body:new URLSearchParams(o)};return fetch(n,a).then(e).then((e=>e.json())).then((e=>e))}(c,i).then((e=>{if("success"===e.transaction.result){let t=d&&4!==d.attempt?d.transaction_id:e.transaction.transactionId;!function(e,t,n,o){return a=this,c=null,i=function*(){var a,c,i,u;let d;const y={action:"createTransactionById",ajax:!0,transactionId:t,blikCode:o.blikCode},m=yield p(e,y),f=m.transaction.status,b=null==(a=m.response)?void 0:a.payments,k=(null==(u=null==(i=null==(c=m.response)?void 0:c.payments)?void 0:i.errors)?void 0:u.length)||0;let v,h=s(o.blikOption);if(v=!0,"failed"===f&&(console.log(k),h.innerHTML="failed",h.classList.add("tpay-blik-response--open"),clearInterval(d),r(o.blikOption,!1),v=!1),"pending"===f&&k>0){let e;!function(e){window.localStorage.setItem("tpay_blik_addepts",JSON.stringify(e))}({transaction_id:t,cart_id:o.cartId,attempt:m.transaction.payments.attempts.length});const n=null!=messages?messages:null;for(const t in b.errors)e="payment_failed"===b.errors[t].errorCode?null==n?void 0:n.blik_error:null==n?void 0:n.payment_error,h.innerHTML=e,h.classList.add("tpay-blik-response--open");clearInterval(d),r(o.blikOption,!1),v=!1}"correct"===f&&(clearInterval(d),r(o.blikOption,!1),window.location.href=m.backUrl,v=!1),v&&l(e,t,n,o,1)},new Promise(((e,t)=>{var n=e=>{try{r(i.next(e))}catch(e){t(e)}},o=e=>{try{r(i.throw(e))}catch(e){t(e)}},r=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,o);r((i=i.apply(a,c)).next())}));var a,c,i}(c,t,e,i)}})))}),!1),function(){const e=document.querySelector('#conditions-to-approve input[type="checkbox"]'),t=document.querySelector(".tpay-blik-input");e.addEventListener("click",(()=>{y()})),t.addEventListener("change",(()=>{y()}))}()}}(),function(){const e=document.querySelectorAll(".tpay-payment-gateways");e.length>0&&e.forEach((function(e){e.parentNode.parentNode.nextElementSibling;const t=Array.from(e.querySelectorAll(".tpay-payment-gateways__item"));if(t)for(const n of t)n.addEventListener("click",(()=>{f(e),t.forEach((e=>{e.classList.remove("tpay-payment-gateways__item--active")})),n.classList.add("tpay-payment-gateways__item--active")}),!1)}))}(),function(){const e=Array.from(document.querySelectorAll("input[name=payment-option]"));Array.from(e).forEach((function(e){e.addEventListener("click",(()=>{var t,n;const o=e.closest(".payment-option");t=o.querySelector(".tpay-regulations");h();const r=o.id.replace(/\D/g,"");const c=(s=r,document.querySelector("#payment-option-"+s+"-additional-information"));var s;let i="";if(c){const e=c.querySelector(".tpay-wrapper");i=null!=(n=null==e?void 0:e.getAttribute("data-payment-type"))?n:null}"blik"===i||"card"===i?(document.querySelector("body").classList.add("tpay-hide-process-btn"),a(),_(r,"hide")):(document.querySelector("body").classList.remove("tpay-hide-process-btn"),_(r,"show"));const l=function(e){return document.querySelector("#pay-with-payment-option-"+e+"-form")}(r).querySelector("input[name=tpay]");k(!!l)}))}))}();const h=()=>{const e=document.querySelectorAll(".payment-options .custom-checkbox span"),t=document.querySelectorAll(".payment-options input");e.forEach((e=>{e.classList.remove("wrong")})),t.forEach((e=>{e.classList.remove("wrong")}))};function _(e,t){if(document.querySelector("#tc-payment-confirmation"))return;const n=document.querySelector("#payment-confirmation");let o;"show"===t?o="block":"hide"===t&&(o="none"),setTimeout((function(){n.style.display=o}),250)}!function(){const e=document.querySelectorAll(".tpay-radio-payments__radio");Array.from(e).forEach((t=>{t.addEventListener("click",(n=>{e.forEach((e=>{e.classList.remove("tpay-radio-payments__radio--active")})),t.classList.add("tpay-radio-payments__radio--active"),t.querySelector("input[type=radio]").checked=!0}))}))}(),function(){const e=document.querySelector('#conditions-to-approve input[type="checkbox"]');e&&e.addEventListener("change",(()=>{var e;f(null==(e=document.querySelector(".tpay-payment-gateways__item--active"))||e.closest(".tpay-payment-gateways"))}));document.querySelectorAll('[name="payment-option"]').forEach((function(e){e.addEventListener("change",(()=>{var e;f(null==(e=document.querySelector(".tpay-payment-gateways__item--active"))||e.closest(".tpay-payment-gateways"))}))}))}()}()}();